@using OrchardCore
@using OrchardCore.Forms.ViewModels

@model FormInputElementVisibilityViewModel

@{
    // Each instance of the form gets its own unique container id.
    var idPrefix = Html.IdForModel();
    // var idPrefix = Html.IdForModel().Replace("_", ".");
}

<div class="@Orchard.GetWrapperClasses()">
    <label asp-for="Action" class="@Orchard.GetLabelClasses()">@T["Action"]</label>
    <div class="@Orchard.GetEndClasses()">
        <select asp-for="Action" asp-items="Model.Actions" class="form-select"></select>
        <span class="hint">@T["The action to take when the condition is met."]</span>
    </div>
</div>

<div class="input-visibility-settings">
    <div id="@(idPrefix)_groupsContainerId" data-groups="@Html.Raw(Json.Serialize(Model.Groups))"></div>
</div>

<div id="operatorData" style="display:none;"
     data-operators='@Html.Raw(Json.Serialize(Model.Groups.First().Rules.First().Operators))'>
</div>

<script asp-name="form-visibility" asp-src="/OrchardCore.Forms/Scripts/form-visibility.min.js" src-debug="/OrchardCore.Forms/Scripts/form-visibility.js" at="Foot" depends-on="vuejs:2"></script>

@* <script at="Foot">
    document.addEventListener('DOMContentLoaded', function () {
        formVisibilityGroups.initialize({
            appElementSelector: '[id$="_groupsContainerId"]',
            prefix: '@Html.NameForModel()'
        });
        console.log('Vue initialization done with appElementSelector: [id$="_groupsContainerId"]');
    });
</script> *@

<script>
    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(() => {
            // const container = document.querySelector('[id$="_groupsContainerId"]');
            const container = document.querySelector('#@(idPrefix)_groupsContainerId');


            if (!container) {
                console.error(`❌ Cannot find element with selector: #@(idPrefix)_groupsContainerId`);

                return;
            }

            formVisibilityGroups.initialize({
                appElementSelector: '#@(idPrefix)_groupsContainerId',
                prefix: '@Html.NameForModel()'
            });

            console.log('✅ Vue initialization done with appElementSelector:', '#@(idPrefix)_groupsContainerId');
        }, 100);  // Add delay to ensure element exists
    });
</script>
@* appElementSelector: '[id$="_groupsContainerId"]', *@